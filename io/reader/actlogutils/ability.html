<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>nari.io.reader.actlogutils.ability API documentation</title>
<meta name="description" content="Parse ability (action) data from ACT log line" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>nari.io.reader.actlogutils.ability</code></h1>
</header>
<section id="section-intro">
<p>Parse ability (action) data from ACT log line</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Parse ability (action) data from ACT log line&#34;&#34;&#34;
from struct import unpack

from nari.types import Timestamp
from nari.types.actioneffect import ActionEffect
from nari.types.event.ability import Ability, AoeAbility
from nari.types.actor import Actor
from nari.types.ability import Ability as AbilityEvent
from nari.types.event import Event
from nari.io.reader.actlogutils.exceptions import ActLineParsingException


def action_effect_from_logline(params: list[str]) -&gt; ActionEffect:
    &#34;&#34;&#34;Takes the eight bytes from an ACT log line and returns ActionEffect data&#34;&#34;&#34;
    if len(params) != 2:
        raise ActLineParsingException(f&#39;Expected 2 arguments to unpack for ActionEffect data, got {len(params)}&#39;)
    hexdata = &#39;&#39;.join([x.zfill(8) for x in params])
    intdata = int(hexdata, 16)
    parsed_params = unpack(&#39;&gt;BBBBHBB&#39;, intdata.to_bytes(8, &#39;big&#39;))
    param0, param1, severity, effect_category, value, flags, multiplier = parsed_params
    return ActionEffect(effect_category=effect_category, severity=severity, flags=flags, value=value, multiplier=multiplier, additional_params=[param0, param1])

def ability_from_logline(timestamp: Timestamp, params: list[str]) -&gt; Event:
    &#34;&#34;&#34;Returns an ability event from an ACT log line

    ACT Event ID (decimal): 21

    ## Param layout from ACT

    The first two params in every event is the ACT event ID and the timestamp it was parsed; the following table documents all the other fields.

    |Index|Type|Description|
    |----:|----|:----------|
    |0    |int|Source actor ID|
    |1    |string|Source actor name|
    |2    |int|Ability ID|
    |3    |string|Ability name|
    |4    |int|Target actor ID|
    |5    |string|Target actor name|
    |6-21 |ActionEffect(s)|Every two fields make up 1 ActionEffect. See `action_effect_from_logline` for more info on parsing this.|
    |22   |int|Source current HP|
    |23   |int|Source max HP|
    |24   |int|Source current MP|
    |25   |int|Source max MP|
    |26   |int|Source current TP/others?|
    |27   |int|Source max TP/others?|
    |28   |float|Source actor X position|
    |29   |float|Source actor Y position|
    |30   |float|Source actor Z position|
    |31   |float|Source actor bearing|
    |32   |int|Target current HP|
    |33   |int|Target max HP|
    |34   |int|Target current MP|
    |35   |int|Target max MP|
    |36   |int|Target current TP/others?|
    |37   |int|Target max TP/others?|
    |38   |float|Target actor X position|
    |39   |float|Target actor Y position|
    |40   |float|Target actor Z position|
    |41   |float|Target actor bearing|
    |42   |int|Sequence ID|

    &#34;&#34;&#34;
    source_actor = Actor(*params[0:2])
    ability = AbilityEvent(*params[2:4])
    target_actor = Actor(*params[4:6])
    action_effects = []
    for i in range(0, 16, 2):
        index = i + 6
        action_effects.append(
            action_effect_from_logline(params[index:index+2])
        )
    # apparently when the target actor is &#39;none&#39;, then the *source* actor&#39;s resources will be empty will also be empty
    # also apparently, other time(s) it will be blank just because /shrug
    try:
        source_actor.resources.update(
            *[int(x) for x in params[22:28]]
        )
        source_actor.position.update(
            *[float(x) for x in params[28:32]]
        )
    except ValueError:
        pass

    try:
        target_actor.resources.update(
            *[int(x) for x in params[32:38]]
        )
        target_actor.position.update(
            *[float(x) for x in params[38:42]]
        )
    except ValueError:
        pass
    sequence_id = int(params[42], 16)

    return Ability(
        timestamp=timestamp,
        action_effects=action_effects,
        source_actor=source_actor,
        target_actor=target_actor,
        ability=ability,
        sequence_id=sequence_id,
    )

def aoeability_from_logline(timestamp: Timestamp, params: list[str]) -&gt; Event:
    &#34;&#34;&#34;Parses an AoE ability from log line&#34;&#34;&#34;
    # see ability_from_logline above for field definitions
    source_actor = Actor(*params[0:2])
    ability = AbilityEvent(*params[2:4])
    target_actor = Actor(*params[4:6])
    action_effects = []
    for i in range(0, 16, 2):
        index = i + 6
        action_effects.append(
            action_effect_from_logline(params[index:index+2])
        )
    try:
        source_actor.resources.update(
            *[int(x) for x in params[22:28]]
        )
        source_actor.position.update(
            *[float(x) for x in params[28:32]]
        )
    except ValueError:
        pass
    try:
        target_actor.resources.update(
            *[int(x) for x in params[32:38]]
        )
        target_actor.position.update(
            *[float(x) for x in params[38:42]]
        )
    except ValueError:
        pass
    sequence_id = int(params[42], 16)
    return AoeAbility(
        timestamp=timestamp,
        action_effects=action_effects,
        source_actor=source_actor,
        target_actor=target_actor,
        ability=ability,
        sequence_id=sequence_id,
    )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="nari.io.reader.actlogutils.ability.ability_from_logline"><code class="name flex">
<span>def <span class="ident">ability_from_logline</span></span>(<span>timestamp: int, params: list[str]) ‑> <a title="nari.types.event.Event" href="../../../types/event/index.html#nari.types.event.Event">Event</a></span>
</code></dt>
<dd>
<div class="desc"><p>Returns an ability event from an ACT log line</p>
<p>ACT Event ID (decimal): 21</p>
<h2 id="param-layout-from-act">Param layout from ACT</h2>
<p>The first two params in every event is the ACT event ID and the timestamp it was parsed; the following table documents all the other fields.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Index</th>
<th>Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td>int</td>
<td style="text-align: left;">Source actor ID</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td>string</td>
<td style="text-align: left;">Source actor name</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td>int</td>
<td style="text-align: left;">Ability ID</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td>string</td>
<td style="text-align: left;">Ability name</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td>int</td>
<td style="text-align: left;">Target actor ID</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td>string</td>
<td style="text-align: left;">Target actor name</td>
</tr>
<tr>
<td style="text-align: right;">6-21</td>
<td>ActionEffect(s)</td>
<td style="text-align: left;">Every two fields make up 1 ActionEffect. See <code><a title="nari.io.reader.actlogutils.ability.action_effect_from_logline" href="#nari.io.reader.actlogutils.ability.action_effect_from_logline">action_effect_from_logline()</a></code> for more info on parsing this.</td>
</tr>
<tr>
<td style="text-align: right;">22</td>
<td>int</td>
<td style="text-align: left;">Source current HP</td>
</tr>
<tr>
<td style="text-align: right;">23</td>
<td>int</td>
<td style="text-align: left;">Source max HP</td>
</tr>
<tr>
<td style="text-align: right;">24</td>
<td>int</td>
<td style="text-align: left;">Source current MP</td>
</tr>
<tr>
<td style="text-align: right;">25</td>
<td>int</td>
<td style="text-align: left;">Source max MP</td>
</tr>
<tr>
<td style="text-align: right;">26</td>
<td>int</td>
<td style="text-align: left;">Source current TP/others?</td>
</tr>
<tr>
<td style="text-align: right;">27</td>
<td>int</td>
<td style="text-align: left;">Source max TP/others?</td>
</tr>
<tr>
<td style="text-align: right;">28</td>
<td>float</td>
<td style="text-align: left;">Source actor X position</td>
</tr>
<tr>
<td style="text-align: right;">29</td>
<td>float</td>
<td style="text-align: left;">Source actor Y position</td>
</tr>
<tr>
<td style="text-align: right;">30</td>
<td>float</td>
<td style="text-align: left;">Source actor Z position</td>
</tr>
<tr>
<td style="text-align: right;">31</td>
<td>float</td>
<td style="text-align: left;">Source actor bearing</td>
</tr>
<tr>
<td style="text-align: right;">32</td>
<td>int</td>
<td style="text-align: left;">Target current HP</td>
</tr>
<tr>
<td style="text-align: right;">33</td>
<td>int</td>
<td style="text-align: left;">Target max HP</td>
</tr>
<tr>
<td style="text-align: right;">34</td>
<td>int</td>
<td style="text-align: left;">Target current MP</td>
</tr>
<tr>
<td style="text-align: right;">35</td>
<td>int</td>
<td style="text-align: left;">Target max MP</td>
</tr>
<tr>
<td style="text-align: right;">36</td>
<td>int</td>
<td style="text-align: left;">Target current TP/others?</td>
</tr>
<tr>
<td style="text-align: right;">37</td>
<td>int</td>
<td style="text-align: left;">Target max TP/others?</td>
</tr>
<tr>
<td style="text-align: right;">38</td>
<td>float</td>
<td style="text-align: left;">Target actor X position</td>
</tr>
<tr>
<td style="text-align: right;">39</td>
<td>float</td>
<td style="text-align: left;">Target actor Y position</td>
</tr>
<tr>
<td style="text-align: right;">40</td>
<td>float</td>
<td style="text-align: left;">Target actor Z position</td>
</tr>
<tr>
<td style="text-align: right;">41</td>
<td>float</td>
<td style="text-align: left;">Target actor bearing</td>
</tr>
<tr>
<td style="text-align: right;">42</td>
<td>int</td>
<td style="text-align: left;">Sequence ID</td>
</tr>
</tbody>
</table></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ability_from_logline(timestamp: Timestamp, params: list[str]) -&gt; Event:
    &#34;&#34;&#34;Returns an ability event from an ACT log line

    ACT Event ID (decimal): 21

    ## Param layout from ACT

    The first two params in every event is the ACT event ID and the timestamp it was parsed; the following table documents all the other fields.

    |Index|Type|Description|
    |----:|----|:----------|
    |0    |int|Source actor ID|
    |1    |string|Source actor name|
    |2    |int|Ability ID|
    |3    |string|Ability name|
    |4    |int|Target actor ID|
    |5    |string|Target actor name|
    |6-21 |ActionEffect(s)|Every two fields make up 1 ActionEffect. See `action_effect_from_logline` for more info on parsing this.|
    |22   |int|Source current HP|
    |23   |int|Source max HP|
    |24   |int|Source current MP|
    |25   |int|Source max MP|
    |26   |int|Source current TP/others?|
    |27   |int|Source max TP/others?|
    |28   |float|Source actor X position|
    |29   |float|Source actor Y position|
    |30   |float|Source actor Z position|
    |31   |float|Source actor bearing|
    |32   |int|Target current HP|
    |33   |int|Target max HP|
    |34   |int|Target current MP|
    |35   |int|Target max MP|
    |36   |int|Target current TP/others?|
    |37   |int|Target max TP/others?|
    |38   |float|Target actor X position|
    |39   |float|Target actor Y position|
    |40   |float|Target actor Z position|
    |41   |float|Target actor bearing|
    |42   |int|Sequence ID|

    &#34;&#34;&#34;
    source_actor = Actor(*params[0:2])
    ability = AbilityEvent(*params[2:4])
    target_actor = Actor(*params[4:6])
    action_effects = []
    for i in range(0, 16, 2):
        index = i + 6
        action_effects.append(
            action_effect_from_logline(params[index:index+2])
        )
    # apparently when the target actor is &#39;none&#39;, then the *source* actor&#39;s resources will be empty will also be empty
    # also apparently, other time(s) it will be blank just because /shrug
    try:
        source_actor.resources.update(
            *[int(x) for x in params[22:28]]
        )
        source_actor.position.update(
            *[float(x) for x in params[28:32]]
        )
    except ValueError:
        pass

    try:
        target_actor.resources.update(
            *[int(x) for x in params[32:38]]
        )
        target_actor.position.update(
            *[float(x) for x in params[38:42]]
        )
    except ValueError:
        pass
    sequence_id = int(params[42], 16)

    return Ability(
        timestamp=timestamp,
        action_effects=action_effects,
        source_actor=source_actor,
        target_actor=target_actor,
        ability=ability,
        sequence_id=sequence_id,
    )</code></pre>
</details>
</dd>
<dt id="nari.io.reader.actlogutils.ability.action_effect_from_logline"><code class="name flex">
<span>def <span class="ident">action_effect_from_logline</span></span>(<span>params: list[str]) ‑> <a title="nari.types.actioneffect.ActionEffect" href="../../../types/actioneffect.html#nari.types.actioneffect.ActionEffect">ActionEffect</a></span>
</code></dt>
<dd>
<div class="desc"><p>Takes the eight bytes from an ACT log line and returns ActionEffect data</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def action_effect_from_logline(params: list[str]) -&gt; ActionEffect:
    &#34;&#34;&#34;Takes the eight bytes from an ACT log line and returns ActionEffect data&#34;&#34;&#34;
    if len(params) != 2:
        raise ActLineParsingException(f&#39;Expected 2 arguments to unpack for ActionEffect data, got {len(params)}&#39;)
    hexdata = &#39;&#39;.join([x.zfill(8) for x in params])
    intdata = int(hexdata, 16)
    parsed_params = unpack(&#39;&gt;BBBBHBB&#39;, intdata.to_bytes(8, &#39;big&#39;))
    param0, param1, severity, effect_category, value, flags, multiplier = parsed_params
    return ActionEffect(effect_category=effect_category, severity=severity, flags=flags, value=value, multiplier=multiplier, additional_params=[param0, param1])</code></pre>
</details>
</dd>
<dt id="nari.io.reader.actlogutils.ability.aoeability_from_logline"><code class="name flex">
<span>def <span class="ident">aoeability_from_logline</span></span>(<span>timestamp: int, params: list[str]) ‑> <a title="nari.types.event.Event" href="../../../types/event/index.html#nari.types.event.Event">Event</a></span>
</code></dt>
<dd>
<div class="desc"><p>Parses an AoE ability from log line</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def aoeability_from_logline(timestamp: Timestamp, params: list[str]) -&gt; Event:
    &#34;&#34;&#34;Parses an AoE ability from log line&#34;&#34;&#34;
    # see ability_from_logline above for field definitions
    source_actor = Actor(*params[0:2])
    ability = AbilityEvent(*params[2:4])
    target_actor = Actor(*params[4:6])
    action_effects = []
    for i in range(0, 16, 2):
        index = i + 6
        action_effects.append(
            action_effect_from_logline(params[index:index+2])
        )
    try:
        source_actor.resources.update(
            *[int(x) for x in params[22:28]]
        )
        source_actor.position.update(
            *[float(x) for x in params[28:32]]
        )
    except ValueError:
        pass
    try:
        target_actor.resources.update(
            *[int(x) for x in params[32:38]]
        )
        target_actor.position.update(
            *[float(x) for x in params[38:42]]
        )
    except ValueError:
        pass
    sequence_id = int(params[42], 16)
    return AoeAbility(
        timestamp=timestamp,
        action_effects=action_effects,
        source_actor=source_actor,
        target_actor=target_actor,
        ability=ability,
        sequence_id=sequence_id,
    )</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="nari.io.reader.actlogutils" href="index.html">nari.io.reader.actlogutils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="nari.io.reader.actlogutils.ability.ability_from_logline" href="#nari.io.reader.actlogutils.ability.ability_from_logline">ability_from_logline</a></code></li>
<li><code><a title="nari.io.reader.actlogutils.ability.action_effect_from_logline" href="#nari.io.reader.actlogutils.ability.action_effect_from_logline">action_effect_from_logline</a></code></li>
<li><code><a title="nari.io.reader.actlogutils.ability.aoeability_from_logline" href="#nari.io.reader.actlogutils.ability.aoeability_from_logline">aoeability_from_logline</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>